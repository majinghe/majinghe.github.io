<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>用 Terraform 操作 RustFS 资源，让对象存储 IaC 化 - 小马哥的博客</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="马景贺（小马哥）"><meta name=description content="用 terraform 对 RustFS 资源进行操作，轻松实现对象存储的基础设施即代码化"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.79.1 with theme even"><link rel=canonical href=https://majinghe.github.io/cloud-native/iac-rustfs/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="用 Terraform 操作 RustFS 资源，让对象存储 IaC 化"><meta property="og:description" content="用 terraform 对 RustFS 资源进行操作，轻松实现对象存储的基础设施即代码化"><meta property="og:type" content="article"><meta property="og:url" content="https://majinghe.github.io/cloud-native/iac-rustfs/"><meta property="article:published_time" content="2025-10-05T09:05:42+08:00"><meta property="article:modified_time" content="2025-10-05T09:05:42+08:00"><meta itemprop=name content="用 Terraform 操作 RustFS 资源，让对象存储 IaC 化"><meta itemprop=description content="用 terraform 对 RustFS 资源进行操作，轻松实现对象存储的基础设施即代码化"><meta itemprop=datePublished content="2025-10-05T09:05:42+08:00"><meta itemprop=dateModified content="2025-10-05T09:05:42+08:00"><meta itemprop=wordCount content="2932"><meta itemprop=keywords content="Cloud Native,terraform,RustFS,IaC,"><meta name=twitter:card content="summary"><meta name=twitter:title content="用 Terraform 操作 RustFS 资源，让对象存储 IaC 化"><meta name=twitter:description content="用 terraform 对 RustFS 资源进行操作，轻松实现对象存储的基础设施即代码化"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>小马哥</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/cloud-native><li class=mobile-menu-item>Cloud Native</li></a><a href=/devsecops><li class=mobile-menu-item>DevSecOps</li></a><a href=/aigc><li class=mobile-menu-item>AIGC</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-T0B2C6W2ZH','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-T0B2C6W2ZH','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><div class=logo-wrapper><a href=/ class=logo>小马哥</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/cloud-native>Cloud Native</a></li><li class=menu-item><a class=menu-item-link href=/devsecops>DevSecOps</a></li><li class=menu-item><a class=menu-item-link href=/aigc>AIGC</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>用 Terraform 操作 RustFS 资源，让对象存储 IaC 化</h1><div class=post-meta><span class=post-time>2025-10-05</span><div class=post-category><a href=/categories/cloud-native/>Cloud Native</a></div><span class=more-meta>约 2932 字</span>
<span class=more-meta>预计阅读 6 分钟</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#前提条件>前提条件</a></li><li><a href=#用-terraform-操作-rustfs-资源>用 Terraform 操作 RustFS 资源</a><ul><li><a href=#terraform-文件配置>Terraform 文件配置</a></li><li><a href=#terraform-操作>Terraform 操作</a></li></ul></li><li><a href=#写在最后>写在最后</a></li></ul></li></ul></nav></div></div><div class=post-content><p>IaC（基础设施即代码）是云原生时代的重要技术栈，通过将基础设施代码化来简化基础设施的管理，而且有助于 GitOps 的实践。RustFS 作为存储领域的基础设施，也可以使用 Terraform 对其进行 IaC 化。本文分享整个实践过程。</p><h2 id=前提条件>前提条件</h2><ul><li><p>Terraform > 1.5</p><p>Terraform 官方提供<a href=https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli>多种安装方式</a>，支持 windows、macOS、Linux 操作系统，根据自身需求安装完毕后，可用 <code>terraform --version</code> 或 <code>terraform --help</code> 来确认安装结果。</p></li><li><p>可用的 RustFS 实例</p><p>RustFS 官方同样提供了<a href=https://docs.rustfs.com/zh/installation/linux/>多种安装方式</a>，安装完毕，可通过 <code>http://localhost:9000</code> 或 <code>http://ip:9000</code> 登录验证。</p></li></ul><h2 id=用-terraform-操作-rustfs-资源>用 Terraform 操作 RustFS 资源</h2><p>Terraform 操作相关资源都是通过 provider 来实现。目前 RustFS 官方还未提供对应的 provider，但由于 RustFS 和 S3 完全兼容，而且是 minio 的平替，所以可以复用 minio 的 provider。</p><p>遗憾的是 minio 官方也并没有提供对应的 provider，但是在 GitHub 上有一个<a href=https://github.com/aminueza/terraform-provider-minio>terraform-provider-minio</a>项目，可以对 minio 资源进行 IaC 管理，该 provider 也在 <a href=https://registry.terraform.io/providers/aminueza/minio/>Terraform 官方 Registry</a> 中，所以，是可信、可用的。目前，此 provider 提供多种 minio 资源，可以对 <code>iam</code>、<code>bucket</code>、<code>object</code> 等进行操作。和其他 provider 的使用一样，在 terraform 配置文件中指定即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>terraform {
  required_providers {
    minio = {
      source = &#34;aminueza/minio&#34;
      version = &#34;3.6.5&#34;
    }
  }
}
</code></pre></td></tr></table></div></div><p>下面演示用此 provider 来对 RustFS 存储桶和对象进行操作。</p><h3 id=terraform-文件配置>Terraform 文件配置</h3><p>首先，创建一个 <code>main.tf</code> 文件，定义好 provider，需要操作的 resource 以及 resource 的输出（可选）。比如，创建一个 RustFS bucket 并且上传一个 txt 文件作为对象。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>terraform {
  required_providers {
    minio = {
      source = &#34;aminueza/minio&#34;
      version = &#34;=3.6.5&#34;
    }
  }
}

provider &#34;minio&#34; {
  minio_server   = var.rustfs_endpoint
  minio_user     = var.rustfs_access_key
  minio_password = var.rustfs_secret_key
  minio_region   = var.rustfs_region
}

resource &#34;minio_s3_bucket&#34; &#34;rustfs_bucket_creation&#34; {
  bucket = var.bucket_name
  acl    = &#34;public&#34;
}

resource &#34;minio_s3_object&#34; &#34;txt_file&#34; {
  depends_on = [minio_s3_bucket.rustfs_bucket_creation]
  bucket_name = minio_s3_bucket.rustfs_bucket_creation.bucket
  object_name = &#34;text.txt&#34;
  content = &#34;Hello World!&#34;
  content_type = &#34;text/plain&#34;
}

output &#34;minio_id&#34; {
  value = &#34;${minio_s3_bucket.rustfs_bucket_creation.id}&#34;
}

output &#34;minio_url&#34; {
  value = &#34;${minio_s3_bucket.rustfs_bucket_creation.bucket_domain_name}&#34;
}
</code></pre></td></tr></table></div></div><p>RustFS 实例的具体信息以及要创建的存储桶名称都定义在 <code>variables.tf</code> 文件中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>variable &#34;rustfs_endpoint&#34; {
  description = &#34;RustFS instance endpoint&#34;
  type        = string
  default     = &#34;http://localhost:9000&#34;
}

variable &#34;rustfs_access_key&#34; {
  description = &#34;RustFS access key&#34;
  type        = string
  default     = &#34;rustfsadmin&#34;
}

variable &#34;rustfs_secret_key&#34; {
  description = &#34;RustFS secret key&#34;
  type        = string
  default     = &#34;rustfsadmin&#34;
}

variable &#34;rustfs_region&#34; {
  description = &#34;The region of RustFS instance&#34;
  type        = string
  default     = &#34;cn-east-1&#34;
}

variable &#34;bucket_name&#34; {
  description = &#34;The name of the RustFS bucket&#34;
  type        = string
  default     = &#34;terraform-demo-bucket&#34;
}
</code></pre></td></tr></table></div></div><p>具体的值都定义在 terraform 的变量文件 <code>terraform.tfvars</code> 中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>rustfs_endpoint   = &#34;11.19.18.15:9000&#34;
rustfs_access_key = &#34;rustfsadmin&#34;
rustfs_secret_key = &#34;rustfsadmin&#34;
rustfs_region     = &#34;cn-east-1&#34;
bucket_name       = &#34;tf-demo-bucket&#34;
</code></pre></td></tr></table></div></div><h3 id=terraform-操作>Terraform 操作</h3><p>众所周知，terraform 有三步曲：<code>init</code>、<code>plan</code>、<code>apply</code>，来完成资源的创建。因此，在上一步骤中三个 tf 文件所在的目录下执行这三个命令。</p><h4 id=执行-init-命令>执行 <code>init</code> 命令</h4><p>执行 <code>terraform init</code> 命令进行初始化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>terraform init
Initializing the backend...
Initializing provider plugins...
- Reusing previous version of aminueza/minio from the dependency lock file
- Using previously-installed aminueza/minio v3.6.5

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &#34;terraform plan&#34; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
</code></pre></td></tr></table></div></div><blockquote><p>如果是初次执行这个命令会去下载配置好的 provider，如本文中的 <code>aminueza/minio</code>。有时候会因为网络问题，可能会导致下载失败，这个时候可以选择手动下载此 provider，并将其拷贝到 terraform 的 plugins 目录下，一般是 <code>~/.terraform.d/plugins/</code>。</p></blockquote><h4 id=执行-plan-命令>执行 <code>plan</code> 命令</h4><p>执行 <code>terraform plan</code> 命令来“预览”对资源的操作，此命令不会真正执行对资源的具体操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>terraform plan

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # minio_s3_bucket.rustfs_bucket_creation will be created
  + resource &#34;minio_s3_bucket&#34; &#34;rustfs_bucket_creation&#34; {
      + acl                = &#34;public&#34;
      + arn                = (known after apply)
      + bucket             = &#34;tf-demo-bucket&#34;
      + bucket_domain_name = (known after apply)
      + force_destroy      = false
      + id                 = (known after apply)
      + object_locking     = false
    }

  # minio_s3_object.txt_file will be created
  + resource &#34;minio_s3_object&#34; &#34;txt_file&#34; {
      + bucket_name  = &#34;tf-demo-bucket&#34;
      + content      = &#34;Hello World!&#34;
      + content_type = &#34;text/plain&#34;
      + etag         = (known after apply)
      + id           = (known after apply)
      + object_name  = &#34;text.txt&#34;
      + version_id   = (known after apply)
    }

Plan: 2 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + minio_id  = (known after apply)
  + minio_url = (known after apply)

──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn&#39;t use the -out option to save this plan, so Terraform can&#39;t guarantee to take exactly these actions if you run &#34;terraform apply&#34; now.
</code></pre></td></tr></table></div></div><p>从结果看，提示操作的资源有两个：</p><ul><li>会创建一个名为 <code>tf-demo-bucket</code> 的存储桶；</li><li>会在 <code>tf-demo-bucket</code> 存储桶中创建一个对象，是一个名为 <code>text.txt</code> 的文件，内容为 <code>Hello World!</code>；</li></ul><p>如果确认无误，执行 <code>apply</code> 命令。</p><h4 id=执行-apply-命令>执行 <code>apply</code> 命令</h4><p>执行 <code>terraform apply</code> 命令对资源进行真正操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>terraform plan

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # minio_s3_bucket.rustfs_bucket_creation will be created
  + resource &#34;minio_s3_bucket&#34; &#34;rustfs_bucket_creation&#34; {
      + acl                = &#34;public&#34;
      + arn                = (known after apply)
      + bucket             = &#34;tf-demo-bucket&#34;
      + bucket_domain_name = (known after apply)
      + force_destroy      = false
      + id                 = (known after apply)
      + object_locking     = false
    }

  # minio_s3_object.txt_file will be created
  + resource &#34;minio_s3_object&#34; &#34;txt_file&#34; {
      + bucket_name  = &#34;tf-demo-bucket&#34;
      + content      = &#34;Hello World!&#34;
      + content_type = &#34;text/plain&#34;
      + etag         = (known after apply)
      + id           = (known after apply)
      + object_name  = &#34;text.txt&#34;
      + version_id   = (known after apply)
    }

Plan: 2 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + minio_id  = (known after apply)
  + minio_url = (known after apply)

──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn&#39;t use the -out option to save this plan, so Terraform can&#39;t guarantee to take exactly these actions if you run &#34;terraform apply&#34; now.
root@iv-ye61b0vg8wcva4gbgjxs:/home/xiaomage/terraform# 
root@iv-ye61b0vg8wcva4gbgjxs:/home/xiaomage/terraform# terraform apply

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # minio_s3_bucket.rustfs_bucket_creation will be created
  + resource &#34;minio_s3_bucket&#34; &#34;rustfs_bucket_creation&#34; {
      + acl                = &#34;public&#34;
      + arn                = (known after apply)
      + bucket             = &#34;tf-demo-bucket&#34;
      + bucket_domain_name = (known after apply)
      + force_destroy      = false
      + id                 = (known after apply)
      + object_locking     = false
    }

  # minio_s3_object.txt_file will be created
  + resource &#34;minio_s3_object&#34; &#34;txt_file&#34; {
      + bucket_name  = &#34;tf-demo-bucket&#34;
      + content      = &#34;Hello World!&#34;
      + content_type = &#34;text/plain&#34;
      + etag         = (known after apply)
      + id           = (known after apply)
      + object_name  = &#34;text.txt&#34;
      + version_id   = (known after apply)
    }

Plan: 2 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + minio_id  = (known after apply)
  + minio_url = (known after apply)

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only &#39;yes&#39; will be accepted to approve.

  Enter a value: yes

minio_s3_bucket.rustfs_bucket_creation: Creating...
minio_s3_bucket.rustfs_bucket_creation: Creation complete after 0s [id=tf-demo-bucket]
minio_s3_object.txt_file: Creating...
minio_s3_object.txt_file: Creation complete after 0s [id=text.txt]

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.

Outputs:

minio_id = &#34;tf-demo-bucket&#34;
minio_url = &#34;http://11.19.18.15:9000/minio/tf-demo-bucket&#34;
</code></pre></td></tr></table></div></div><p>过程中需要确认是否执行此操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only &#39;yes&#39; will be accepted to approve.

  Enter a value: yes
</code></pre></td></tr></table></div></div><p>执行结果显示，新增了两个资源（<code>Resources: 2 added</code>）。可以通过 RustFS Web 页面查看 <code>tf-demo-bucket</code> 存储桶是否存在，下面是否有名为 <code>text.txt</code> 的文件，内容为 <code>Hello World!</code>。</p><p><img src=./images/terraform-rustfs-verify.png alt="terraform rustfs verify"></p><h4 id=执行-destroy-命令>执行 <code>destroy</code> 命令</h4><p>如果想要销毁创建的资源，直接执行 <code>terraform destroy</code> 命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>terraform destroy
minio_s3_bucket.rustfs_bucket_creation: Refreshing state... [id=tf-demo-bucket]
minio_s3_object.txt_file: Refreshing state... [id=text.txt]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # minio_s3_bucket.rustfs_bucket_creation will be destroyed
  - resource &#34;minio_s3_bucket&#34; &#34;rustfs_bucket_creation&#34; {
      - acl                = &#34;public&#34; -&gt; null
      - arn                = &#34;arn:aws:s3:::tf-demo-bucket&#34; -&gt; null
      - bucket             = &#34;tf-demo-bucket&#34; -&gt; null
      - bucket_domain_name = &#34;http://11.19.18.15:9000/minio/tf-demo-bucket&#34; -&gt; null
      - force_destroy      = false -&gt; null
      - id                 = &#34;tf-demo-bucket&#34; -&gt; null
      - object_locking     = false -&gt; null
    }

  # minio_s3_object.txt_file will be destroyed
  - resource &#34;minio_s3_object&#34; &#34;txt_file&#34; {
      - bucket_name  = &#34;tf-demo-bucket&#34; -&gt; null
      - content      = &#34;Hello World!&#34; -&gt; null
      - content_type = &#34;text/plain&#34; -&gt; null
      - etag         = &#34;93933050aa1531ba16cd156dc42f7cc1-1&#34; -&gt; null
      - id           = &#34;text.txt&#34; -&gt; null
      - object_name  = &#34;text.txt&#34; -&gt; null
        # (1 unchanged attribute hidden)
    }

Plan: 0 to add, 0 to change, 2 to destroy.

Changes to Outputs:
  - minio_id  = &#34;tf-demo-bucket&#34; -&gt; null
  - minio_url = &#34;http://11.19.18.15:9000/minio/tf-demo-bucket&#34; -&gt; null

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only &#39;yes&#39; will be accepted to confirm.

  Enter a value: yes

minio_s3_object.txt_file: Destroying... [id=text.txt]
minio_s3_object.txt_file: Destruction complete after 0s
minio_s3_bucket.rustfs_bucket_creation: Destroying... [id=tf-demo-bucket]
minio_s3_bucket.rustfs_bucket_creation: Destruction complete after 0s

Destroy complete! Resources: 2 destroyed.
</code></pre></td></tr></table></div></div><p>过程中也需要确认是否要执行销毁操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only &#39;yes&#39; will be accepted to confirm.

  Enter a value: yes
</code></pre></td></tr></table></div></div><p>执行结果是销毁了两个资源（<code>Resources: 2 destroyed.</code>）。</p><p>如果在 RustFS Web 页面上查看，会发现之前创建的存储桶 <code>tf-demo-bucket</code> 已不存在。</p><p>可以用类似的方式来对其他资源进行操作。感兴趣的可以自行实践。</p><h2 id=写在最后>写在最后</h2><p>复用 minio 的 provider 可以实现对 RustFS 资源的操作，侧面说明了 RustFS 是 minio 的平替。另外，通过 IaC 来操作 RustFS 资源，会让整个基础设施的管理更加简单化。</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>马景贺（小马哥）</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2025-10-05</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/cloud-native/>Cloud Native</a>
<a href=/tags/terraform/>terraform</a>
<a href=/tags/rustfs/>RustFS</a>
<a href=/tags/iac/>IaC</a></div><nav class=post-nav><a class=next href=/cloud-native/rustfs-k3s/><span class="next-text nav-default">在 k3s 上部署新一代高性能分布式存储 RustFS</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=devops008@sina.com class="iconfont icon-email" title=email></a><a href=https://github.com/majinghe class="iconfont icon-github" title=github></a><a href=https://majinghe.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020 -
2025<span class=heart><i class="iconfont icon-heart"></i></span><span>olOwOlo</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-T0B2C6W2ZH','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>