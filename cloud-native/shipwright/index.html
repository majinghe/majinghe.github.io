<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>使用 shipwright 在 Kubernetes 上构建容器镜像 - 小马哥的博客</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="马景贺（小马哥）"><meta name=description content="Shipwright 是一个可扩展的框架，用来在 Kubernetes 上构建容器镜像"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.79.1 with theme even"><link rel=canonical href=https://majinghe.github.io/cloud-native/shipwright/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="使用 shipwright 在 Kubernetes 上构建容器镜像"><meta property="og:description" content="Shipwright 是一个可扩展的框架，用来在 Kubernetes 上构建容器镜像"><meta property="og:type" content="article"><meta property="og:url" content="https://majinghe.github.io/cloud-native/shipwright/"><meta property="article:published_time" content="2021-11-16T13:05:42+08:00"><meta property="article:modified_time" content="2021-11-16T13:05:42+08:00"><meta itemprop=name content="使用 shipwright 在 Kubernetes 上构建容器镜像"><meta itemprop=description content="Shipwright 是一个可扩展的框架，用来在 Kubernetes 上构建容器镜像"><meta itemprop=datePublished content="2021-11-16T13:05:42+08:00"><meta itemprop=dateModified content="2021-11-16T13:05:42+08:00"><meta itemprop=wordCount content="2039"><meta itemprop=keywords content="Cloud Native,container image,"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 shipwright 在 Kubernetes 上构建容器镜像"><meta name=twitter:description content="Shipwright 是一个可扩展的框架，用来在 Kubernetes 上构建容器镜像"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>小马哥</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/cloud-native><li class=mobile-menu-item>Cloud Native</li></a><a href=/devsecops><li class=mobile-menu-item>DevSecOps</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-T0B2C6W2ZH','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-T0B2C6W2ZH','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>使用 shipwright 在 Kubernetes 上构建容器镜像</h1><div class=post-meta><span class=post-time>2021-11-16</span><div class=post-category><a href=/categories/security/>Security</a></div><span class=more-meta>约 2039 字</span>
<span class=more-meta>预计阅读 5 分钟</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#shipwright-介绍>Shipwright 介绍</a></li><li><a href=#shipwright-使用>Shipwright 使用</a><ul><li><a href=#shipwright-安装>Shipwright 安装</a></li><li><a href=#使用-shipwright-构建镜像>使用 shipwright 构建镜像</a><ul><li><a href=#创建-container-registry-的-secret>创建 Container Registry 的 Secret</a></li><li><a href=#创建-build>创建 Build</a></li><li><a href=#创建-buildrun>创建 BuildRun</a></li><li><a href=#结果验证>结果验证</a></li></ul></li></ul></li><li><a href=#写在最后>写在最后</a></li></ul></nav></div></div><div class=post-content><p><img src=images/shipwright.png alt=shipwright></p><h1 id=shipwright-介绍>Shipwright 介绍</h1><p><a href=https://github.com/shipwright-io/build><code>Shipwright</code></a> 是一个可扩张的框架，用来在 Kubernetes 上构建容器镜像。<code>Shipwright</code> 支持众多流行的用于构建容器镜像的工具，比如 <code>Kaniko</code>、<code>Cloud Native Buildpacks</code>、<code>Buildah</code>等。</p><p><code>Shipwright</code> 有构建四要素：</p><ul><li><strong>Source Code</strong>：(WHAT)制定了我们要构建的内容</li><li><strong>Output image</strong>：(WHERE)构建镜像的推送地</li><li><strong>Build Strategy</strong>：(HOW)如何构建镜像，也就是要选择上述提到的那种工具来构建</li><li><strong>Invocation</strong>：(WHEN)什么时候开始构建镜像</li></ul><p>Shipwright 的 Build API 是由三个核心 CRD（CustomResourceDefinitions）组成，分别是：</p><ul><li><strong>Build</strong>：定义构建的内容以及镜像仓库地址</li><li><strong>BuildStrategy and ClusterBuildStrategy</strong>：定义了如何利用某种工具来构建镜像</li><li><strong>BuildRun</strong>：和 <code>Build</code> 相关联。可以创建 <code>BuildRun</code> 来启动和运行 <code>Build</code>。</li></ul><blockquote><p><code>Build</code> 和 <code>BuildRun</code> 的关系与 Tekton 中 <code>Task</code> 和 <code>TaskRun</code> 的关系是一样的。</p></blockquote><h1 id=shipwright-使用>Shipwright 使用</h1><h2 id=shipwright-安装>Shipwright 安装</h2><ul><li>安装前提</li></ul><p>Shipwirght 依赖于 Tekton，需要提前安装 Tekton。Tekton 的安装可以参考<a href=https://tekton.dev/docs/getting-started/>官网安装教程</a>。可以用 <code>version</code> 或者 <code>help</code> 命令来确认 Tekton 是否安装成功：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ tkn version
Client version: 0.20.0
Pipeline version: v0.28.0
</code></pre></td></tr></table></div></div><p>执行如下命令即可完成 Shipwright deployment 安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl apply --filename https://github.com/shipwright-io/build/releases/download/v0.6.0/release.yaml
namespace/shipwright-build created
role.rbac.authorization.k8s.io/shipwright-build-controller created
clusterrole.rbac.authorization.k8s.io/shipwright-build-controller created
clusterrolebinding.rbac.authorization.k8s.io/shipwright-build-controller created
rolebinding.rbac.authorization.k8s.io/shipwright-build-controller created
serviceaccount/shipwright-build-controller created
deployment.apps/shipwright-build-controller created
customresourcedefinition.apiextensions.k8s.io/buildruns.shipwright.io created
customresourcedefinition.apiextensions.k8s.io/builds.shipwright.io created
customresourcedefinition.apiextensions.k8s.io/buildstrategies.shipwright.io created
customresourcedefinition.apiextensions.k8s.io/clusterbuildstrategies.shipwright.io created

</code></pre></td></tr></table></div></div><p>可以在 <code>shipwright-build</code> namespace 下面查看 pod</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n shipwright-build get pods
NAME                                           READY   STATUS    RESTARTS   AGE
shipwright-build-controller-5f7b744cd5-cllz7   1/1     Running   0          5m31s
</code></pre></td></tr></table></div></div><p>接下来需要安装 <code>strategy</code>。<code>strategy</code> 是一系列 <code>step</code> 的定义，主要是用开头叙述的集中主流镜像工具来完成镜像工作。<code>strategy</code> 有两种：<code>ClusterBuildStrategy</code>（对应的 API 是 <code>clusterbuildstrategies.shipwright.io/v1alpha1</code>）和 <strong>BuildStrategy</strong>（对应的 API 是 <code>buildstrategies.shipwright.io/v1alpha1</code>）。这两种的区别就是：<strong>前者是针对集群级别的，而后者是针对 <code>namespace</code> 级别的</strong>。</p><p>可用下面的命令完成 <code>strategy</code> 的安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl apply --filename https://github.com/shipwright-io/build/releases/download/v0.6.0/sample-strategies.yaml
clusterbuildstrategy.shipwright.io/buildah created
clusterbuildstrategy.shipwright.io/buildkit created
clusterbuildstrategy.shipwright.io/buildpacks-v3-heroku created
clusterbuildstrategy.shipwright.io/buildpacks-v3 created
clusterbuildstrategy.shipwright.io/kaniko-trivy created
clusterbuildstrategy.shipwright.io/kaniko created
clusterbuildstrategy.shipwright.io/ko created
clusterbuildstrategy.shipwright.io/source-to-image-redhat created
clusterbuildstrategy.shipwright.io/source-to-image created
</code></pre></td></tr></table></div></div><p>当然，也可以单独安装针对某个构建工具的 <code>strategy</code>，比如如下步骤即可完成针对 <code>kaniko</code> 的 <code>strategy</code>。</p><ul><li>安装 Kaniko Cluster scope Strategy</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl apply -f https://raw.githubusercontent.com/shipwright-io/build/main/samples/buildstrategy/kaniko/buildstrategy_kaniko_cr.yaml
clusterbuildstrategy.shipwright.io/kaniko configured
</code></pre></td></tr></table></div></div><ul><li>安装 <code>kaniko-trivy</code> ClusterBuildStrategy</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl apply -f https://raw.githubusercontent.com/shipwright-io/build/main/samples/buildstrategy/kaniko/buildstrategy_kaniko-trivy_cr.yaml
clusterbuildstrategy.shipwright.io/kaniko-trivy configured
</code></pre></td></tr></table></div></div><p>其实可以看到，<code>kaniko</code> 的 <code>strategy</code> 其实就是 <code>kaniko</code> 的一个封装，可以在上述的 <code>yaml</code> 文件中看到正常用 <code>kaniko</code> 进行镜像构建的步骤：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>spec:
  buildSteps:
    - name: build-and-push
      image: gcr.io/kaniko-project/executor:v1.7.0
      workingDir: $(params.shp-source-root)
      securityContext:
        runAsUser: 0
      env:
        - name: HOME
          value: /tekton/home
        - name: DOCKER_CONFIG
          value: /tekton/home/.docker
      command:
        - /kaniko/executor
      args:
        - --skip-tls-verify=true
        - --dockerfile=$(build.dockerfile)
        - --context=$(params.shp-source-context)
        - --destination=$(params.shp-output-image)
        - --oci-layout-path=/kaniko/oci-image-layout
        - --snapshotMode=redo
        - --push-retry=3
</code></pre></td></tr></table></div></div><p>至此，所有的安装已经完毕，接下来可以使用 <code>shipwright</code> 来构建镜像了。</p><h2 id=使用-shipwright-构建镜像>使用 shipwright 构建镜像</h2><p>先创建一个 <code>namespace</code>，后续的所有操作都会在这个 <code>namespace</code> 下面。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl create ns shipwright-demo
namespace/shipwright-demo created
</code></pre></td></tr></table></div></div><h3 id=创建-container-registry-的-secret>创建 Container Registry 的 Secret</h3><p>使用如下内容创建一个 <code>Secret</code> 用来访问 Container Registry</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cat &gt; secret.yaml &lt;&lt; EOF
apiVersion: v1
kind: Secret
metadata:
    name: dockerhub-user-pass
    annotations:
        tekton.dev/docker-0: https://index.docker.io
type: kubernetes.io/basic-auth
stringData:
    username: your-dockerhub-username
    password: your-dockerhub-password
EOF
</code></pre></td></tr></table></div></div><p>使用 <code>kubectl apply</code> 命令创建 <code>secret</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n shipwright-demo apply -f secret.yaml
secret/dockerhub-user-pass created
</code></pre></td></tr></table></div></div><h3 id=创建-build>创建 Build</h3><p>使用如下内容创建一个 <code>Build</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cat &gt; build.yaml &lt;&lt; EOF
apiVersion: shipwright.io/v1alpha1
kind: Build
metadata:
  name: kaniko-golang-build
  annotations:
    build.build.dev/build-run-deletion: &#34;true&#34;
spec:
  source:
    url: https://github.com/devopsday-dl/Demo
  strategy:
    name: kaniko
    kind: ClusterBuildStrategy
  output:
    image: dllhb/shipwright-demo:v1.0.2
    credentials:
      name: dockerhub-user-pass
EOF
</code></pre></td></tr></table></div></div><p>参数说明：</p><ul><li><strong><code>spec.source</code></strong>：指定包含源码的 Git 仓库地址</li><li><strong><code>spec.strategy</code></strong>：指定需要构建镜像的 Strategy，也就是说要选择那款工具（本示例选择了 <code>kaniko</code>）</li><li><strong><code>spec.output</code></strong>：指定远端镜像仓库，用来存储构建出来的镜像</li><li><strong><code>spec.output.credentials.name</code></strong>：指定用来访问镜像仓库的 <code>secret</code></li></ul><p>使用 <code>kubectl apply</code> 命令创建 <code>build</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n shipwright-demo apply -f build.yaml
build.shipwright.io/kaniko-golang-build created
</code></pre></td></tr></table></div></div><h3 id=创建-buildrun>创建 BuildRun</h3><p>使用如下内容创建 <code>BuildRun</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ cat &gt; buildrun.yaml &lt;&lt; EOF
apiVersion: shipwright.io/v1alpha1
kind: BuildRun
metadata:
  name: shipwright-buildrun-demo
spec:
  buildRef:
    name: kaniko-golang-build
EOF
</code></pre></td></tr></table></div></div><p>参数说明：</p><ul><li><strong><code>spec.buildRef</code></strong>：指定与此 <code>BuildRun</code> 相关联的 <code>Build</code>，也即上一步创建的 <code>Build</code></li></ul><p>使用 <code>kubectl apply</code> 命令创建 <code>BuildRun</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n shipwright-demo apply -f buildrun.yaml
buildrun.shipwright.io/shipwright-buildrun-demo created
</code></pre></td></tr></table></div></div><h3 id=结果验证>结果验证</h3><p>接下来可以查看 <code>Build</code>、<code>BuildRun</code> 以及 <code>shipwright</code> ns 下面的 pod</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n shipwright-demo get build,buildrun
NAME                                      REGISTERED   REASON      BUILDSTRATEGYKIND      BUILDSTRATEGYNAME   CREATIONTIME
build.shipwright.io/kaniko-golang-build   True         Succeeded   ClusterBuildStrategy   kaniko              13s

NAME                                              SUCCEEDED   REASON    STARTTIME   COMPLETIONTIME
buildrun.shipwright.io/shipwright-buildrun-demo   Unknown     Pending   10s

$ kubectl -n shipwright-demo get pods -w
NAME                                       READY   STATUS    RESTARTS   AGE
shipwright-buildrun-demo-k5jpb-pod-t6gfz   3/3     Running   0          22s
shipwright-buildrun-demo-k5jpb-pod-t6gfz   2/3     NotReady   0          22s
</code></pre></td></tr></table></div></div><p>可以看到镜像的构建正在进行，可以查看一下，是否有 <code>taskrun</code> 生成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ tkn -n shipwright-demo taskrun list
NAME                             STARTED        DURATION   STATUS
shipwright-buildrun-demo-k5jpb   1 minute ago   ---        Running
</code></pre></td></tr></table></div></div><p>可以看到，<code>BuildRun</code> 触发了 <code>Build</code>，而 <code>Build</code> 又创建了一个 <code>TaksRun</code> 来执行镜像构建。</p><p>可以查看 <code>pod</code> 的 <code>log</code> 来查看镜像构建的过程：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n shipwright-demo logs -f shipwright-buildrun-demo-k5jpb-pod-t6gfz -c step-build-and-push
INFO[0010] Resolved base name golang:1.12.9-alpine3.9 to builder
INFO[0010] Retrieving image manifest golang:1.12.9-alpine3.9
INFO[0010] Retrieving image golang:1.12.9-alpine3.9 from registry index.docker.io
...... TO LONG ......
INFO[0058] Unpacking rootfs as cmd COPY --from=builder /tmp/devops /usr/src/app/ requires it.
INFO[0064] WORKDIR /usr/src/app/
INFO[0064] cmd: workdir
INFO[0064] Changed working directory to /usr/src/app/
INFO[0064] Creating directory /usr/src/app/
INFO[0064] Taking snapshot of files...
INFO[0064] COPY --from=builder /tmp/devops /usr/src/app/
INFO[0064] Taking snapshot of files...
INFO[0064] CMD [&#34;./devops&#34;]
INFO[0066] Pushing image to dllhb/shipwright-demo:v1.0.2
INFO[0075] Pushed image to 1 destinations
</code></pre></td></tr></table></div></div><h1 id=写在最后>写在最后</h1><p>Shiwright 使用了 Kubernetes 的扩展机制（CRD），将多种主流镜像构建的工具进行了一个封装，再使用 Tekton 做一个构建引擎。原理比较简单，好处就是不用去关心每个构建工具是如何使用，因为将所有的工具做了一层封装，用户只需要通过简单的声明就可以用不同的工具来完成镜像的构建。</p><p>其实，<code>shipwright</code> 的好处就是不用去关系每个构建工具是如何使用，将所有的工具做了一层封装，用户只需要通过简单的声明就可以用不同的工具来完成镜像的构建。</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>马景贺（小马哥）</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-11-16</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/cloud-native/>Cloud Native</a>
<a href=/tags/container-image/>container image</a></div><nav class=post-nav><a class=prev href=/cloud-native/tekton-supply-chain/><i class="iconfont icon-left"></i><span class="prev-text nav-default">Tekton Chains 是如何保证 Tekton 供应链安全的</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/cloud-native/jenkins-operator/><span class="next-text nav-default">Jenkins Operator —— Jenkins 在 Kubernetes 上打开的正确方式</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=devops008@sina.com class="iconfont icon-email" title=email></a><a href=https://github.com/majinghe class="iconfont icon-github" title=github></a><a href=https://majinghe.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>olOwOlo</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-T0B2C6W2ZH','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>